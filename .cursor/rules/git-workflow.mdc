---
description: Git branching and PR workflow for all changes
alwaysApply: true
---

# Git Workflow

**Never push directly to `main`.** No exceptions — not even one-liners or typo fixes.

## Required Workflow

```bash
# 1. Branch off main
git checkout main && git pull origin main
git checkout -b <type>/<short-description>

# 2. Make changes, commit
git add -A
git commit -m "<type>: <description>"

# 3. Run checks before pushing (see post-change-checks rule)
bun run typecheck && trunk check --fix && bun test && bun run knip

# 4. Push and open PR
git push origin <branch>
gh pr create --base main --title "..." --body "..."
```

## Branch Naming

| Type | When |
| --- | --- |
| `feature/` | New functionality |
| `fix/` | Bug fixes |
| `chore/` | Docs, deps, config, refactoring |

## Conflict Resolution: Rebase-Only

When a branch falls behind `main`, **always rebase — never merge**:

```bash
# ❌ Never do this — creates a merge commit that breaks GitHub's rebase button
git merge origin/main

# ✅ Always do this
git fetch origin
git rebase origin/main
```

After rebasing, force-push the branch:

```bash
git push --force-with-lease origin <branch>
```

(`--force-with-lease` aborts safely if someone else pushed to the branch in the meantime.)

## Force Push Policy

| Branch | Force push? |
| --- | --- |
| `main` | ❌ Never |
| Feature branch, after rebase | ✅ Use `--force-with-lease` |

## PR Merge Strategy

Always use **"Rebase and merge"** on GitHub. Never "Create a merge commit".

## Why

CI deploys on push to `main`. Unreviewed changes go straight to production.
PRs give a chance to catch issues before they affect the daily briefing.
Linear history makes `git log` readable and bisecting easy.
